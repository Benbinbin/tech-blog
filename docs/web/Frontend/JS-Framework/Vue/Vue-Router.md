# Vue router
[Vue Router](https://router.vuejs.org/zh/) æ˜¯å®˜æ–¹çš„è·¯ç”±ç®¡ç†å™¨ï¼Œä½¿ç”¨ Vue.js  æˆ‘ä»¬å·²ç»å¯ä»¥é€šè¿‡ç»„åˆç»„ä»¶æ¥ç»„æˆåº”ç”¨ç¨‹åºï¼Œå½“ä½ è¦æŠŠ Vue Router æ·»åŠ è¿›æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†ç»„ä»¶ components æ˜ å°„åˆ°è·¯ç”± routesï¼Œé€šè¿‡ Vue Router å¯ä»¥é€šè¿‡å‰ç«¯æ¨¡æ‹Ÿåç«¯çš„è·¯ç”±åˆ‡æ¢ï¼Œå°±å¯ä»¥åœ¨å•é¡µé¢ï¼ˆåŒä¸€åœ°å€ï¼‰ä¸ŠåŠ¨æ€åŠ è½½/æ¸²æŸ“ç›¸åº”çš„ç»„ä»¶ã€‚ä½¿ç”¨ Vue.js é…åˆ Vue Router ä½¿å¾—åˆ›å»ºå•é¡µåº”ç”¨å˜å¾—éå¸¸ç®€å•ã€‚

![Vue router](./images/20200618140426048_6209.png)

Vue router åŒ…å«çš„åŠŸèƒ½æœ‰ï¼š

- åµŒå¥—çš„è·¯ç”±/è§†å›¾è¡¨
- æ¨¡å—åŒ–çš„ã€åŸºäºç»„ä»¶çš„è·¯ç”±é…ç½®
- è·¯ç”±å‚æ•°ã€æŸ¥è¯¢ã€é€šé…ç¬¦
- åŸºäº Vue.js è¿‡æ¸¡ç³»ç»Ÿçš„è§†å›¾è¿‡æ¸¡æ•ˆæœ
- ç»†ç²’åº¦çš„å¯¼èˆªæ§åˆ¶
- å¸¦æœ‰è‡ªåŠ¨æ¿€æ´»çš„ CSS class çš„é“¾æ¥
- HTML5 å†å²æ¨¡å¼æˆ– hash æ¨¡å¼ï¼Œåœ¨ IE9 ä¸­è‡ªåŠ¨é™çº§
- è‡ªå®šä¹‰çš„æ»šåŠ¨æ¡è¡Œä¸º

## å®‰è£… Vue router
ä½¿ç”¨ Vue router æ¨¡å—ä¹‹å‰ï¼Œéœ€è¦ç°åœ¨é¡¹ç›®ä¸­å®‰è£…ä¾èµ–åŒ…

```bash
$ npm install vue-router --save
```

![vue router directory architecture](./images/20200526215012042_11336.png)

## é…ç½®è·¯ç”±


å¦‚æœåœ¨ä¸€ä¸ªæ¨¡å—åŒ–å·¥ç¨‹ä¸­ä½¿ç”¨å®ƒï¼Œè¿˜éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å¼•å…¥å®˜æ–¹ç»„ä»¶ï¼ˆRouter é…ç½®æ–‡ä»¶æ˜¯ `src/router/index.js`ï¼Œå®ƒå­˜å‚¨äº†ç»„ä»¶ components ä¸è·¯ç”± routesï¼ˆç½‘å€ï¼‰çš„æ˜ å°„å…³ç³»ï¼‰ï¼Œå¹¶é€šè¿‡ `Vue.use()` æ˜ç¡®åœ°åœ¨ Vue å®ä¾‹ä¸­å®‰è£…/åŠ è½½è·¯ç”±åŠŸèƒ½ï¼Œè¿˜è¦ä½¿ç”¨å…³é”®å­— `export` [å°†é…ç½®æ–‡ä»¶/æ¨¡å—çš„å˜é‡æˆ–å‡½æ•°å¯¼å‡º](../../JavaScript/è¯­æ³•åŸºç¡€/æ¨¡å—.md)å°†é…ç½®å¥½çš„æ˜ å°„å…³ç³»ï¼ˆ`VurRouter` å¯¹è±¡ï¼‰å¯¼å‡ºï¼Œä»¥ä¾› Webpack è¯»å–/å¯¼å…¥

```js
// ğŸ“ index.js
// å¯¼å…¥å®˜æ–¹ç»„ä»¶
import Vue from 'vue';
import VueRouter from 'vue-router';

// åœ¨ Vue å®ä¾‹å…¨å±€ä¸Šå®‰è£…è·¯ç”±åŠŸèƒ½
Vue.use(VueRouter);

// æ–°å»º VueRouter å¯¹è±¡å¹¶å¯¼å‡ºï¼Œå…¶ä¸­åŒ…å«è™šæ‹Ÿè·¯ç”±åœ°å€å’Œç»„ä»¶çš„æ˜ å°„
export default new VueRouter({});
```

:bulb: å¦‚æœä½¿ç”¨å…¨å±€çš„ `<script>` æ ‡ç­¾ä»¥ CDN æ–¹å¼åŠ è½½ Vue router åŠŸèƒ½ï¼Œåˆ™æ— é¡»å¦‚æ­¤ (æ‰‹åŠ¨å®‰è£…)ã€‚

å†åœ¨ Webpack çš„å…¥å£ entry æ–‡ä»¶ `main.js` è¯»å–/å¯¼å…¥ `import`

```js
// ğŸ“ main.js
// ...
import router from './router';

// åœ¨ Vue å®ä½“ä¸­æ·»åŠ è¯¥æ–¹æ³•
new Vue({
  // ...
  router,
});
```

## æ¨¡æ‹Ÿé¡µé¢åˆ‡æ¢
åœ¨ Router é…ç½®æ–‡ä»¶æ˜¯ `src/router/index.js` å®šä¹‰è™šæ‹Ÿè·¯ç”±è·¯å¾„å’Œç»„ä»¶çš„æ˜ å°„å…³ç³»ï¼Œä»¥å®ç°æ¨¡æ‹Ÿé¡µé¢åˆ‡æ¢çš„åŠŸèƒ½ã€‚åœ¨å±æ€§ `routes` ä¸­é…ç½®çš„æ¯ä¸ªè·¯ç”±å¯¹è±¡ä¸º **è·¯ç”±è®°å½•**ï¼Œå®ƒè¡¨ç¤ºè·¯ç”±è·¯å¾„å’Œç»„ä»¶ä¹‹é—´çš„å…³ç³»ã€‚

:bulb: éœ€è¦å…ˆåœ¨é…ç½®æ–‡ä»¶ä¸­å¯¼å…¥æ‰€è¦ä½¿ç”¨çš„ç»„ä»¶ã€‚å¦‚æœä½¿ç”¨çš„æ˜¯ Vue-Cli 3 å¯ä»¥åœ¨é…ç½®è·¯ç”±çš„ componet å±æ€§æ—¶ç”¨ç®­å¤´æ–¹å¼çš„å½¢å¼å¯¼å…¥å¯¹åº”çš„ç»„ä»¶ `component: () => import('../views/component_name.vue')`

```js
// ğŸ“ index.js
// å¯¼å…¥è‡ªå®šä¹‰çš„åˆ†é¡µç»„ä»¶ï¼ˆä»¥ä¸‹ç¤ºä¾‹ä¸­ä»¥é‡å‘½åæ–¹å¼å¯¼å…¥æ¨¡å—ï¼‰
import Home from '@/components/HelloWorld';

// ...
// é…ç½®è™šæ‹Ÿè·¯ç”±è·¯å¾„å’Œå…ƒä»¶çš„æ˜ å°„å…³ç³»
exprot default new VueRouter({
  routes: [
    {
      name: 'é¦–é¡µ',   // ç»„ä»¶å‘ˆç°çš„åç§°
      path: '/index',   // å¯¹åº”çš„è™šæ‹Ÿè·¯å¾„
      component: Home,   // å¯¹åº”çš„ç»„ä»¶
    },
  ],
});
```

åœ¨ç»„ä»¶çš„æ ¹èŠ‚ç‚¹ `App.vue` çš„ HTM æ¨¡æ¿ä¸­ä½¿ç”¨å…ƒç´  `<router-link to="path">` è®¾ç½®åˆ‡æ¢è·¯ç”±çš„é“¾æ¥ï¼Œç±»ä¼¼äºé”šå…ƒç´  `<a>`ï¼Œä½†å®ƒä½¿ç”¨ç‰¹æ€§ `to` æŒ‡å®šè·³è½¬çš„è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ç”¨åŠ¨æ€ç»‘å®šçš„æ–¹å¼ `:to="{name: 'Name'}"`ï¼ˆä»¥è™šæ‹Ÿè·¯ç”±çš„åå­— `name` æ¥è¡¨ç¤ºï¼‰ï¼›ä½¿ç”¨å…ƒç´  `<router-view>` è¡¨ç¤ºåˆ‡æ¢è·¯ç”±æ—¶æ¸²æŸ“å…ƒä»¶çš„ä½ç½®ã€‚

```vue
// ğŸ“ App.vue
<templat>
  <div id="app">
    <!-- å¯¼èˆªæ  -->
    <ul>
      <!-- ä»¥ä¸‹ä¸¤ç§æ–¹å¼ã€Œè·³è½¬ã€åˆ°åŒä¸€é¡µé¢ -->
      <li><router-link to="/index">Home</router-link></li>
      <li><router-link :to="{name: 'é¦–é¡µ'}">Home</router-link></li>
    </ul>
    <!-- åˆ‡æ¢è·¯ç”±æ—¶åŠ¨æ€æ¸²æŸ“ç»„ä»¶çš„ä½ç½® -->
    <router-view></router-view>
  </div>
</template>
```

:bulb: æœ‰æ—¶å€™æƒ³åœ¨åŒä¸€ä¸ªè·¯ç”±åœ°å€/é¡µé¢ä¸­å±•ç¤ºå¤šä¸ªè§†å›¾ï¼ˆåŒçº§è§†å›¾ï¼Œè€Œä¸æ˜¯åµŒå¥—å±•ç¤ºï¼‰`<router-view>`ï¼Œå¦‚åœ¨åŒä¸€ä¸ªå¸ƒå±€ä¸­åŒæ—¶æ¸²æŸ“ `sidebar` å’Œ `main` ä¸¤ä¸ªç»„ä»¶ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥åœ¨ HTML æ¨¡æ¿ä¸­ä½¿ç”¨å¤šä¸ª[å‘½åè§†å›¾](https://router.vuejs.org/zh/guide/essentials/named-views.html) `<router-view name="componentName">` ç›¸åº”åç§°çš„ç»„ä»¶å°±ä¼šåœ¨ URL åˆ‡æ¢åˆ°è¯¥é¡µé¢æ—¶å°±ä¼šè¢«æ¸²æŸ“ï¼›å¦‚æœ `<router-view>` æ²¡æœ‰è®¾ç½®åå­—ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯é»˜è®¤ default è§†å›¾ï¼Œè¯¥é¡µé¢åœ¨ `VueRouter` æ³¨å†Œçš„ç»„ä»¶å°±ä¼šåœ¨è¿™é‡Œæ¸²æŸ“ï¼ˆè¿™ä¸ªç»„ä»¶æ²¡æœ‰ç›¸åº”çš„å‘½åè§†å›¾ï¼‰ã€‚

```js
// ğŸ“ index.js
// å¯¼å…¥æ‰€éœ€çš„ç»„ä»¶
import Page from '@/components/pages/page';
import Menu from '@/components/pages/menu'

// è®¾ç½®ç»„ä»¶å’Œè·¯ç”±çš„æ˜ å°„å…³ç³»
export default new VueRouter({
  routes: [
    // ...
    {
      name: 'åˆ†é¡µ',
      path: '/page',
      // ä½¿ç”¨ components å¯¹è±¡æŒ‡å®šåŒä¸ªè·¯ç”±/è·¯å¾„ä¸‹å¯¹åº”ï¼ˆåŠ è½½ï¼‰å¤šä¸ªç»„ä»¶
      components: {
        default: Page,   // é»˜è®¤ç»„ä»¶ï¼Œåœ¨é»˜è®¤è§†å›¾ä¸­æ¸²æŸ“
        menu: Menu,  // åœ¨å¯¹åº”çš„å‘½åè§†å›¾ä¸­æ¸²æŸ“
      },
    },
  ],
});
```

```vue
// ğŸ“ App.vue
// è®¾ç½®åŠ è½½å¤šä¸ªè§†å›¾
<template>
  <div id="app">
    <!-- code block -->
    <!-- å‘½åè§†å›¾ -->
    <router-view name="menu"></router-view>
    <div class="container">
      <!-- é»˜è®¤è§†å›¾ -->
      <router-view></router-view>
    </div>
  </div>
</template>

<!-- code block -->
```

:bulb: å¦‚æœå¸Œæœ›ç”¨æˆ·ä»»æ„è¾“å…¥è·¯å¾„æ—¶ï¼Œå¯ä»¥è‡ªåŠ¨é‡å®šå‘åˆ°æŒ‡å®šçš„é¡µé¢ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªç‰¹å®šçš„è·¯ç”±è®°å½•ï¼ˆç½®äº `routes` è·¯ç”±é…ç½®å¯¹è±¡æœ€åï¼‰ï¼Œå…¶ `path` å±æ€§ä½¿ç”¨é€šé…ç¬¦ `*` æ¥åŒ¹é…ä»»æ„è·¯å¾„ï¼Œå¹¶é€šè¿‡å±æ€§ `redirect` æ¥æŒ‡å®šé‡å®šå‘çš„è·¯å¾„ï¼›æˆ–è€…å°†å…¶æ˜ å°„åˆ° `NotFound.vue` ç»„ä»¶ï¼Œå‘ç”¨æˆ·å±•ç¤º 404 é¡µé¢ï¼Œå¹¶æä¾›è¿”å›ä¸»é¡µçš„æŒ‰é’®ã€‚

```js
// ğŸ“ index.js
// é…ç½®è·¯ç”±çš„é‡å®šå‘
export default new Router({
  routes: [
  // ...
    {
      path: '*',
      redirect: '/login'
    },
  ]
})

```

## åµŒå¥—è·¯ç”±
å®é™…å¼€å‘ä¸­åº”ç”¨ç•Œé¢é€šå¸¸ç”±å¤šå±‚åµŒå¥—çš„ç»„ä»¶ç»„åˆè€Œæˆï¼Œè€Œä¸”å¸Œæœ›å¯ä»¥å®ç°é¡µé¢éƒ¨åˆ†åŒºåŸŸæ›´æ–°åˆ‡æ¢ç»„ä»¶ï¼Œå¯é€šè¿‡è®¾ç½®åµŒå¥—è·¯ç”±ï¼ŒåŠ¨æ€åˆ‡æ¢ URL ä¸­çš„éƒ¨åˆ†æ®µæ—¶å¯ä»¥é€‰æ‹©åŠ è½½ç›¸åº”çš„åµŒå¥—ç»„ä»¶ã€‚

![nest router](./images/20200527105515988_25626.png)

Vue Router é…ç½®æ–‡ä»¶æ˜¯ `src/router/index.js`ï¼Œåœ¨å…¶ä¸­å®šä¹‰åµŒå¥—è·¯ç”±è·¯å¾„å’Œç»„ä»¶çš„æ˜ å°„å…³ç³»ï¼ˆéœ€è¦å°†ç›¸åº”ç»„ä»¶å¯¼å…¥ï¼‰ï¼Œå¹¶åœ¨ç›¸åº”çš„ç»„ä»¶ä¸­ä½¿ç”¨å…ƒç´  `<router-link>` å’Œ `<router-view>` æ·»åŠ ã€Œè·³è½¬ã€é“¾æ¥å’Œç»„ä»¶æ¸²æŸ“ä½ç½®ã€‚

```js
// ğŸ“ index.js
// å¯¼å…¥åµŒå¥—ç»„ä»¶
import child from '@/components/pages/child';
import child2 from '@/components/pages/child2';
import child3 from '@/components/pages/child3';

export default new VueRouter({
  routes: [
    // ...
    {
      // å½“åµŒå¥—ç»„ä»¶è®¾å®šäº†é»˜è®¤åŠ è½½æ—¶ï¼Œéœ€è¦åˆ é™¤çˆ¶ç»„ä»¶çš„ name ä½¿ç”¨é»˜è®¤åŠ è½½ç»„ä»¶çš„åå­—
      path: '/page',
      component: Page,
      // æ·»åŠ åµŒå¥—è·¯ç”±å’ŒåµŒå¥—ç»„ä»¶çš„å¯¹åº”å…³ç³»
      children: [
        {
          name: 'å¡ç‰‡1',
          path: '',   // ä¸æŒ‡å®šè·¯ç”±è·¯å¾„çš„åµŒå¥—ç»„ä»¶ä½œä¸ºé»˜è®¤åŠ è½½ç»„ä»¶
          component: child,
        },
        {
          name: 'å¡ç‰‡2',
          path: 'child2',
          component: child2,
        },
        {
          name: 'å¡ç‰‡3',
          path: 'child3',
          component: child3,
        },
      ]
    },
  ],
});
```

:bulb: ä»¥ `/` å¼€å¤´çš„åµŒå¥—è·¯å¾„ä¼šè¢«å½“ä½œæ ¹è·¯å¾„ï¼Œå› æ­¤åœ¨è®¾ç½®åµŒå¥—ç»„ä»¶ä¸è·¯ç”± `path` çš„æ˜ å°„å…³ç³»æ—¶ï¼Œå¯ä»¥ç›´æ¥å†™åµŒå¥—è·¯ç”±å¯¹åº”çš„ï¼ˆå³ç»„ä»¶ç‰¹æœ‰çš„ï¼‰éƒ¨åˆ†å³å¯ï¼Œè€Œæ— éœ€è€ƒè™‘ URL å‰é¢å…¬ç”¨çš„éƒ¨åˆ†ã€‚

åœ¨çˆ¶ç»„ä»¶ä¸­è®¾ç½®åµŒå¥—ç»„ä»¶çš„æ’å…¥ä½ç½®åŠåˆ‡æ¢çš„é“¾æ¥

```vue
// ğŸ“ page.vue
<template>
  <div class="hello container">
    <router-link to="/page/">å¡ç‰‡1</router-link>   <!-- é»˜è®¤åµŒå¥—ç»„ä»¶ -->
    <router-link to="/page/child2">å¡ç‰‡2</router-link>
    <router-link to="/page/child3">å¡ç‰‡3</router-link>
    <div class="card">
      <router-view></router-view>
    </div>
  </div>
</template>
```

## åŠ¨æ€è·¯ç”±
æˆ‘ä»¬ç»å¸¸éœ€è¦æŠŠæŸç§æ¨¡å¼åŒ¹é…åˆ°çš„æ‰€æœ‰è·¯ç”±ï¼ˆURL è·¯å¾„ï¼‰å…¨éƒ½æ˜ å°„åˆ°åŒä¸ªç»„ä»¶ï¼Œå¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ª User ç»„ä»¶ï¼Œå¯¹äºæ‰€æœ‰ ID å„ä¸ç›¸åŒçš„ç”¨æˆ·ï¼ˆé€šè¿‡ Ajax è·å–ï¼‰æ•°æ®ï¼Œéƒ½è¦ä½¿ç”¨è¿™ä¸ªç»„ä»¶æ¥æ¸²æŸ“ã€‚

Vue Router é…ç½®æ–‡ä»¶æ˜¯ `src/router/index.js` å®šä¹‰åŠ¨æ€è·¯ç”±è·¯å¾„å‚æ•° dynamic segment æ¥å®ç°å¤šä¸ªè·¯å¾„æ˜ å°„åˆ°åŒä¸€ä¸ªç»„ä»¶ã€‚

```js
// ğŸ“ index.js
// å¯¼å…¥æ‰€éœ€çš„å…ƒä»¶
import User from '@/components/user';

export default new VueRouter({
  routes: [
    // ...
    {
      name: 'ç”¨æˆ·',
      path: '/user/:id',   // åŠ¨æ€è·¯å¾„å‚æ•°ä»¥å†’å·å¼€å¤´
      component: User,   // æ‰€æœ‰ç¬¦åˆä»¥ä¸Šæ¨¡å¼çš„åŠ¨æ€ URL éƒ½æ˜ å°„åˆ° User ç»„ä»¶
    },
  ],
});
```

```vue
// ğŸ“ user.vue
// User ç»„ä»¶
<template>
  <div>
    <p>{{ user.results[0].name.first }}</p>
  </div>
</template>

<script>
export default {
  data() {
    return {
      user: {}
    };
  },
  created() {
    let id = this.$route.params.id;   // è·å–æµè§ˆå™¨åœ°å€æ ä¸­çš„ URL éƒ¨åˆ†ç‰‡æ®µï¼Œä¸åŠ¨æ€è·¯ç”±è·¯å¾„çš„ id éƒ¨åˆ†ç›¸åº”
    // å°† id ä½œä¸º seedsï¼Œä½¿ç”¨ axios å‘ api å‘å‡ºå¼‚æ­¥è¯·æ±‚
    this.$http.get(`https://randomuser.me/api/?seed=${id}`).then(response => {
      this.user = response.data;
    })
  }
};
</script>
```

:bulb: ä¸€èˆ¬åœ¨ç»„ä»¶ä¸­**ä½¿ç”¨æ–¹æ³• `this.$route.params.id` è·å– URL åŠ¨æ€å˜åŒ–çš„ç›¸åº”ç‰‡æ®µ**ï¼Œä»¥è·å–ç‰¹å®šçš„æ•°æ®

:bulb: å¦‚æœéœ€è¦ä½¿ç”¨[ç¼–ç¨‹å¼çš„å¯¼èˆª](#è·¯ç”±å¯¼èˆª)ï¼Œå¦‚æ–¹æ³• `router.push()`ï¼Œåˆ‡æ¢åˆ°ç‰¹å®š `id` çš„é¡µé¢ï¼Œå¯ä»¥ä½¿ç”¨å‚æ•° `params`

```vue
// å‘½åçš„è·¯ç”±ï¼Œæµè§ˆå™¨è·¯å¾„åˆ‡æ¢ä¸º /user/123
router.push({ name: 'user', params: { userId: '123' }})
```

## è·¯ç”±å¯¼èˆª
é™¤äº†ä½¿ç”¨ `<router-lnk>` åˆ›å»ºå¯¼èˆªé“¾æ¥ï¼Œä»¥ä¾›ç”¨æˆ·ç‚¹å‡»åˆ‡æ¢é¡µé¢ï¼ŒVue router å®ä¾‹æä¾›äº†ä¸€äº›æ–¹æ³•ï¼Œå¯ç”¨äºå®ç°è·¯ç”±å¯¼èˆªï¼ˆå³ URL çš„æ”¹å˜ï¼‰ä»¥è§¦å‘é¡µé¢æ¸²æŸ“ç›¸åº”çš„ç»„ä»¶

- `router.push()`
- `router.replace()`
- `router.go()`
- `router.back()`
- `router.forward()`

:bulb: å½“ Vue å®ä¾‹å®‰è£…/åŠ è½½äº† `router` åŠŸèƒ½ï¼Œåˆ™åœ¨ Vue å®ä¾‹å†…éƒ¨å¯ä»¥é€šè¿‡ `this.$router` è®¿é—®è·¯ç”±å®ä¾‹ï¼Œå…¶æ–¹æ³•å¯ä»¥é€šè¿‡ `this.$router.push` è¿™ç§å½¢å¼è°ƒç”¨ã€‚

### push æ–¹æ³•
å¯¼èˆªåˆ°ä¸åŒçš„ URL `location`ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå‘ history æ ˆ**æ·»åŠ ä¸€ä¸ªæ–°çš„è®°å½•**ï¼Œæ‰€ä»¥å½“ç”¨æˆ·ç‚¹å‡»æµè§ˆå™¨åé€€æŒ‰é’®ï¼ˆæˆ–è°ƒç”¨æ–¹æ³• `router.back()`ï¼‰æ—¶ï¼Œåˆ™å›åˆ°ä¹‹å‰çš„ URLã€‚

```js
router.push(location, [onComplete], [onAbort])

router.push(location).then(onComplete).catch(onAbort)
```

å‚æ•°è¯´æ˜ï¼š
*  å‚æ•° `location` æ˜¯å¸Œæœ›å¯¼èˆªåˆ‡æ¢çš„è·¯å¾„ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²è·¯å¾„ï¼Œæˆ–è€…ä¸€ä¸ªæè¿°åœ°å€çš„å¯¹è±¡ã€‚

    ```js
    // å­—ç¬¦ä¸²
    router.push('home')

    // å¯¹è±¡
    router.push({ path: 'home' })

    // å‘½åçš„è·¯ç”±ï¼Œå˜æˆ /user/123
    router.push({ name: 'user', params: { userId: '123' }})

    // å¸¦æŸ¥è¯¢å‚æ•°ï¼Œå˜æˆ /register?plan=private
    router.push({ path: 'register', query: { plan: 'private' }})
    ```

* ï¼ˆå¯é€‰ï¼‰å‚æ•° `onComplete` å’Œ `onAbort` æ˜¯å›è°ƒå‡½æ•°ï¼Œå°†ä¼šåœ¨å¯¼èˆªæˆåŠŸå®Œæˆ (åœ¨æ‰€æœ‰çš„å¼‚æ­¥é’©å­è¢«è§£æä¹‹å) æˆ–ç»ˆæ­¢ (å¯¼èˆªåˆ°ç›¸åŒçš„è·¯ç”±ã€æˆ–åœ¨å½“å‰å¯¼èˆªå®Œæˆä¹‹å‰å¯¼èˆªåˆ°å¦ä¸€ä¸ªä¸åŒçš„è·¯ç”±) çš„æ—¶å€™è¿›è¡Œç›¸åº”çš„è°ƒç”¨ã€‚æ­¤æ—¶å¦‚æœæ”¯æŒ Promiseï¼Œrouter.push æˆ– router.replace å°†è¿”å›ä¸€ä¸ª Promiseã€‚

|                 å£°æ˜å¼                 |           ç¼–ç¨‹å¼           |
| ----------------------------------------- | ----------------------------- |
| `<router-link :to="...">` | `router.push(...)` |


### replace æ–¹æ³•
è·Ÿ `router.push` å¾ˆåƒï¼Œå”¯ä¸€çš„ä¸åŒå°±æ˜¯ï¼Œ**å®ƒä¸ä¼šå‘ history æ·»åŠ æ–°è®°å½•**ï¼Œè€Œæ˜¯è·Ÿå®ƒçš„æ–¹æ³•åä¸€æ ·ï¼Œå³æ›¿æ¢æ‰å½“å‰çš„ history è®°å½•ï¼Œå› æ­¤æ— æ³•é€šè¿‡ç‚¹å‡»æµè§ˆå™¨åé€€æŒ‰é’®ï¼ˆæˆ–è°ƒç”¨æ–¹æ³• `router.back()`ï¼‰å›åˆ°å‰ä¸€ä¸ªé¡µé¢çš„ URLï¼Œè€Œæ˜¯å†å‰ä¸€ä¸ªé¡µé¢ URL

```js
router.replace(location, onComplete?, onAbort?)
```

| å£°æ˜å¼ | ç¼–ç¨‹å¼ |
| --- | --- |
| `<router-link :to="..." replace>` | `router.replace(...)` |

### go æ–¹æ³•
è¿™ä¸ªæ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œæ„æ€æ˜¯åœ¨ history è®°å½•ä¸­å‘å‰æˆ–è€…åé€€å¤šå°‘æ­¥ï¼Œç±»ä¼¼ `window.history.go(n)`ã€‚

```js
// åœ¨æµè§ˆå™¨è®°å½•ä¸­å‰è¿›ä¸€æ­¥ï¼Œç­‰åŒäº history.forward() æˆ– $this.router.forward()
router.go(1)

// åé€€ä¸€æ­¥è®°å½•ï¼Œç­‰åŒäº history.back() æˆ– $this.router.back()
router.go(-1)

// å‰è¿› 3 æ­¥è®°å½•
router.go(3)

// å¦‚æœ history è®°å½•ä¸å¤Ÿç”¨ï¼Œé‚£å°±é»˜é»˜åœ°å¤±è´¥å‘—
router.go(-100)
router.go(100)
```

## å¯¼èˆªå®ˆå«

å‚è€ƒï¼š:cinema: [Vue.js Firebase Authentication - Add To An Existing Project](https://www.bilibili.com/video/bv12K4y147pX) | ç»“åˆ Firebase åç«¯éªŒè¯

Vue router é€šè¿‡è·³è½¬æˆ–å–æ¶ˆçš„æ–¹å¼æä¾›[å¯¼èˆªå®ˆå«](https://router.vuejs.org/zh/guide/advanced/navigation-guards.html)ï¼Œå³ç¦æ­¢åœ¨ç‰¹å®šçš„æ¡ä»¶ä¸‹è®¿é—®ç‰¹å®šçš„ URLã€‚æœ‰å¤šç§æ–¹æ³•å°†å®ˆå«æ¤å…¥è·¯ç”±å¯¼èˆªè¿‡ç¨‹ä¸­ï¼Œå¦‚å…¨å±€çš„ã€å•ä¸ªè·¯ç”±ç‹¬äº«çš„ã€æˆ–è€…ç»„ä»¶çº§çš„ã€‚

å¸¸ç”¨ `router.beforeEach` æ³¨å†Œä¸€ä¸ªå…¨å±€å‰ç½®å®ˆå«ï¼Œå®ƒä¼šåœ¨é¡µé¢è¿›è¡Œåˆ‡æ¢æ—¶è§¦å‘ï¼Œå¯¹è·¯ç”±å¯¼èˆªè¿›è¡Œæ§åˆ¶ï¼Œå¦‚è®¿é—®çš„é¡µé¢éœ€è¦ç™»é™†æ—¶å¯ä»¥æ£€æŸ¥é¡µé¢çš„ç™»é™†çŠ¶æ€ä»¥å†³å®šæ˜¯å¦ã€Œæ”¾è¡Œã€ã€‚

```js
router.beforEach((to, from, next) => {
  // ...
})
```

å‚æ•°è¯´æ˜ï¼š
- å‚æ•° `to` å³å°†è¦è¿›å…¥çš„ç›®æ ‡è·¯ç”±å¯¹è±¡
- å‚æ•° `from` å½“å‰å¯¼èˆªæ­£è¦ç¦»å¼€çš„è·¯ç”±
- å‚æ•° `next` è§¦å‘çš„å›è°ƒå‡½æ•°ï¼Œ**è·¯ç”±å¯¼èˆªæ‰§è¡Œæ•ˆæœä¾èµ– `next` æ–¹æ³•çš„ `resolve` ç»“æœ**ï¼Œç¡®ä¿ `next` å‡½æ•°åœ¨ä»»ä½•ç»™å®šçš„å¯¼èˆªå®ˆå«ä¸­éƒ½è¢«ä¸¥æ ¼è°ƒç”¨ä¸€æ¬¡ã€‚
    - `next()` è¿›è¡Œç®¡é“ä¸­çš„ä¸‹ä¸€ä¸ªé’©å­ã€‚å¦‚æœå…¨éƒ¨é’©å­æ‰§è¡Œå®Œäº†ï¼Œåˆ™å¯¼èˆªçš„çŠ¶æ€å°±æ˜¯ç¡®è®¤çš„ confirmedï¼Œå³ã€Œæ”¾è¡Œã€å¯è®¿é—® `to` æŒ‡å‘çš„è·¯å¾„
    - `next(false)` ä¸­æ–­å½“å‰çš„å¯¼èˆªã€‚å¦‚æœæµè§ˆå™¨çš„ URL æ”¹å˜äº†ï¼ˆå¯èƒ½æ˜¯ç”¨æˆ·æ‰‹åŠ¨æˆ–è€…æµè§ˆå™¨åé€€æŒ‰é’®ï¼‰ï¼Œé‚£ä¹ˆ URL åœ°å€ä¼šé‡ç½®åˆ° `from` è·¯ç”±å¯¹åº”çš„åœ°å€ã€‚
    - `next('/')` æˆ–è€… `next({ path: '/' })` è·³è½¬åˆ°ä¸€ä¸ªä¸åŒçš„åœ°å€ã€‚å½“å‰çš„å¯¼èˆªè¢«ä¸­æ–­ï¼Œç„¶åè¿›è¡Œä¸€ä¸ªæ–°çš„å¯¼èˆªã€‚å¯ä»¥å‘ `next` ä¼ é€’ä»»æ„ä½ç½®å¯¹è±¡ï¼Œä¸”å…è®¸è®¾ç½®è¯¸å¦‚ `replace: true`ã€`name: 'home'` ä¹‹ç±»çš„é€‰é¡¹ä»¥åŠä»»ä½•ç”¨åœ¨ [`router-link` çš„ `to` prop](https://router.vuejs.org/zh/api/#to) æˆ– [`router.push`](https://router.vuejs.org/zh/api/#router-push) ä¸­çš„é€‰é¡¹ã€‚
    - `next(error)` (åœ¨ Vue Router ç‰ˆæœ¬ 2.4.0+ æ–°å¢) å¦‚æœä¼ å…¥ `next` çš„å‚æ•°æ˜¯ä¸€ä¸ª `Error` å®ä¾‹ï¼Œåˆ™å¯¼èˆªä¼šè¢«ç»ˆæ­¢ä¸”è¯¥é”™è¯¯ä¼šè¢«ä¼ é€’ç»™ [`router.onError()`](https://router.vuejs.org/zh/api/#router-onerror) æ³¨å†Œè¿‡çš„å›è°ƒã€‚

```js
// ğŸ“ main.js
// åœ¨ç”¨æˆ·æœªèƒ½éªŒè¯èº«ä»½æ—¶é‡å®šå‘åˆ° /login
router.beforeEach((to, from, next) => {
  if (to.name !== 'Login' && !isAuthenticated) next({ name: 'Login' })
  else next()
})
```

:bulb: å®ˆå«æ˜¯å¼‚æ­¥è§£ææ‰§è¡Œï¼Œæ­¤æ—¶å¯¼èˆªåœ¨æ‰€æœ‰å®ˆå« `resolve` å®Œä¹‹å‰ä¸€ç›´å¤„äº **ç­‰å¾…ä¸­**ã€‚
:warning: ç¡®ä¿ `next` å‡½æ•°åœ¨ä»»ä½•ç»™å®šçš„å¯¼èˆªå®ˆå«ä¸­éƒ½è¢«ä¸¥æ ¼è°ƒç”¨ä¸€æ¬¡ï¼Œå¦åˆ™é»˜è®¤æ‰§è¡Œå®ˆå«ï¼Œå³ç¦æ­¢è®¿é—®ç›¸åº”è·¯å¾„å¹¶å°† URL åœ°å€ä¼šé‡ç½®åˆ° `from` è·¯ç”±å¯¹åº”çš„åœ°å€ã€‚

ä¸€ä¸ªé¡µé¢æ˜¯å¦éœ€è¦éªŒè¯å¯ä»¥åœ¨ `routes` é…ç½®ä¸­çš„è·¯ç”±å¯¹è±¡/è·¯ç”±è®°å½•çš„[è·¯ç”±å…ƒä¿¡æ¯](https://router.vuejs.org/zh/guide/advanced/meta.html) `meta` å±æ€§ä¸­è¿›è¡Œå®šä¹‰ã€‚

å½“è·¯ç”±å¯¼èˆªæ—¶ï¼Œä¸€ä¸ªè·¯ç”±ï¼ˆè·¯å¾„ï¼‰åŒ¹é…åˆ°çš„æ‰€æœ‰è·¯ç”±è®°å½•ï¼ˆæˆ‘ä»¬ç§°å‘¼ `routes` é…ç½®ä¸­çš„æ¯ä¸ªè·¯ç”±å¯¹è±¡ä¸º **è·¯ç”±è®°å½•**ï¼Œ:bulb: ç”±äºè·¯ç”±è®°å½•å¯ä»¥æ˜¯åµŒå¥—çš„ï¼Œå› æ­¤ä¸€ä¸ªè·¯ç”±å¯èƒ½åŒ¹é…å¤šä¸ªè·¯ç”±è®°å½•ï¼‰ä¼šæš´éœ²ä¸º `$route` å¯¹è±¡ï¼ˆè¿˜æœ‰åœ¨å¯¼èˆªå®ˆå«ä¸­çš„è·¯ç”±å¯¹è±¡ï¼‰çš„ `$route.matched` **æ•°ç»„**ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦éå† `$route.matched` ï¼ˆå¦‚ä½¿ç”¨[æ•°ç»„æ–¹æ³• `some()`](../../JavaScript/è¯­æ³•åŸºç¡€/æ•°ç»„.md) éå†å…¶ä¸­çš„å…ƒç´ ï¼‰æ¥æ£€æŸ¥è·¯ç”±è®°å½•ä¸­çš„ `meta` å­—æ®µã€‚ä¸€èˆ¬åœ¨å…¨å±€å¯¼èˆªå®ˆå«ä¸­æ£€æŸ¥å…ƒå­—æ®µï¼Œå¯¹äºéœ€è¦ç™»é™†æˆæƒçš„é¡µé¢ä¼šåœ¨ `next` å›è°ƒå‡½æ•°ä¸­è¿›è¡ŒéªŒè¯ç™»é™†çŠ¶æ€ï¼Œæ‰å†³å®šæ˜¯å¦ã€Œæ”¾è¡Œã€ã€‚

```js
// ğŸ“ index.js
// ä¸ºç‰¹å®šçš„è·¯ç”±è®¾ç½®ç™»é™†é™åˆ¶
export default new Router({
  routes: [
    {
      path: '/',
      name: 'HelloWorld',
      component: HelloWorld,
      meta: { requiresAuth: true },
    },
  ]
})

```

```js
// ğŸ“ main.js
// åœ¨å¯¼èˆªå®ˆå«ä¸­æ£€æŸ¥ç™»é™†çŠ¶æ€
router.beforeEach((to, from, next) => {
  // æŸ¥çœ‹è®¿é—®çš„é¡µé¢ï¼ˆè·¯ç”±è·¯å¾„ï¼‰æ˜¯å¦éœ€è¦ç™»é™†
  if(to.meta.requiresAuth) {
    // è®¿é—® API æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å¤„äºç™»é™†çŠ¶æ€
    const api = `${process.env.API_PATH}/api/user/check`;
    axios.post(api).then(response => {
      console.log(response.data);
      if (response.data.success) {
        // å¦‚æœ API è¿”å›ç»“æœè¡¨ç¤ºå¤„äºç™»é™†çŠ¶æ€å°±ã€Œæ”¾è¡Œã€
        next();
      } else {
        // å¦‚æœ API è¿”å›ç»“æœè¡¨ç¤ºç”¨æˆ·æœªç™»å½•å°±åˆ‡å›åˆ°ç™»é™†çš„é¡µé¢
        next({
          path: '/login'
        })
      }
    });
  } else {
    // å¦‚æœé¡µé¢ä¸éœ€è¦ç™»é™†å¯ä»¥ç›´æ¥ã€Œæ”¾è¡Œã€
    next();
  }
})
```