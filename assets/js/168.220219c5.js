(window.webpackJsonp=window.webpackJsonp||[]).push([[168],{1114:function(t,s,a){t.exports=a.p+"assets/img/20200513201955666_23102.2d715b75.png"},1445:function(t,s,a){"use strict";a.r(s);var e=a(18),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"websocket"}},[t._v("WebSocket")]),t._v(" "),e("p",[t._v("åœ¨ "),e("a",{attrs:{href:"http://tools.ietf.org/html/rfc6455",target:"_blank",rel:"noopener noreferrer"}},[t._v("RFC 6455"),e("OutboundLink")],1),t._v(" è§„èŒƒä¸­æè¿°çš„ "),e("code",[t._v("WebSocket")]),t._v(" åè®®æä¾›äº†ä¸€ç§åœ¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´"),e("strong",[t._v("å»ºç«‹æŒä¹…è¿æ¥æ¥äº¤æ¢æ•°æ®")]),t._v("çš„æ–¹æ³•ï¼Œæ•°æ®å¯ä»¥ä½œä¸ºã€Œæ•°æ®åŒ…ã€åœ¨ä¸¤ä¸ªå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ é€’ï¼Œè€Œä¸ä¼šæ–­å¼€è¿æ¥å’Œå…¶ä»– HTTP è¯·æ±‚ï¼Œå¯¹äºéœ€è¦è¿ç»­æ•°æ®äº¤æ¢çš„æœåŠ¡ï¼Œä¾‹å¦‚ç½‘ç»œæ¸¸æˆï¼Œå®æ—¶äº¤æ˜“ç³»ç»Ÿç­‰ï¼ŒWebSocket å°¤å…¶æœ‰ç”¨ã€‚")]),t._v(" "),e("h2",{attrs:{id:"å»ºç«‹è¿æ¥"}},[t._v("å»ºç«‹è¿æ¥")]),t._v(" "),e("p",[t._v("ä½¿ç”¨æ„é€ å‡½æ•° "),e("code",[t._v("WebSocket")]),t._v(" åˆ›å»ºä¸€ä¸ª WebSocket è¿æ¥ï¼Œç„¶åå®ƒå°†ç«‹å³å¼€å§‹è¿æ¥ã€‚")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" socket "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocket")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ws://javascript.info"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("âš ï¸ åœ¨è¿æ¥æœŸé—´ï¼Œæµè§ˆå™¨ï¼ˆä½¿ç”¨ headerï¼‰è¯¢é—®æœåŠ¡å™¨æ˜¯å¦æ”¯æŒ WebSocket åè®®ï¼Œå¦‚æœæœåŠ¡å™¨å“åº”æ”¯æŒï¼Œé‚£ä¹ˆé€šä¿¡å°±ä»¥ WebSocket åè®®ç»§ç»­è¿›è¡Œï¼Œ"),e("strong",[t._v("è¯¥åè®®æ ¹æœ¬ä¸æ˜¯ HTTP")]),t._v("ã€‚ åˆ›å»º WebSocket è¿æ¥éœ€è¦åœ¨ url ä¸­ä½¿ç”¨ç‰¹æ®Šçš„ "),e("code",[t._v("ws")]),t._v(" æˆ– "),e("code",[t._v("wss")]),t._v(" åè®®ã€‚")]),t._v(" "),e("p",[e("img",{attrs:{src:a(1114),alt:"setup websocket connect"}})]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// ç”± new WebSocket("wss://javascript.info/chat") å‘å‡ºçš„è¯·æ±‚ header')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GET")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("chat\nHost"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" javascript"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("info\nOrigin"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" https"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("javascript"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("info\nConnection"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Upgrade\nUpgrade"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" websocket\nSec"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("WebSocket"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Key"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Iv8io"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("s"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("lYFgZWcXczP8Q"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v("\nSec"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("WebSocket"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Version"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v("\n")])])]),e("p",[t._v("ğŸ’¡ ç±»ä¼¼äº HTTPSï¼ŒWebSocket åŒæ ·ä¹Ÿæœ‰ä¸€ä¸ªåŠ å¯†çš„ "),e("code",[t._v("wss://")]),t._v(" åè®®ï¼Œå› ä¸º "),e("code",[t._v("ws://")]),t._v(" æ•°æ®ä¸æ˜¯åŠ å¯†çš„ï¼Œå¯¹äºä»»ä½•ä¸­é—´äººæ¥è¯´å…¶æ•°æ®éƒ½æ˜¯å¯è§çš„ï¼Œå¹¶ä¸”æ—§çš„ä»£ç†æœåŠ¡å™¨ä¸äº†è§£ WebSocketï¼Œå®ƒä»¬å¯èƒ½ä¼šå› ä¸ºçœ‹åˆ°ã€Œå¥‡æ€ªçš„ã€ header è€Œä¸­æ­¢è¿æ¥ï¼›è€Œ "),e("code",[t._v("wss://")]),t._v(" æ˜¯åŸºäº TLS çš„ WebSocketï¼Œç±»ä¼¼äº HTTPS æ˜¯åŸºäº TLS çš„ HTTPï¼Œä¼ è¾“å®‰å…¨å±‚åœ¨å‘é€æ–¹å¯¹æ•°æ®è¿›è¡Œäº†åŠ å¯†åœ¨æ¥æ”¶æ–¹è¿›è¡Œè§£å¯†ï¼Œå› æ­¤åº”è¯¥å§‹ç»ˆä½¿ç”¨æ›´å¯é çš„ "),e("code",[t._v("wss://")]),t._v(" åè®®ã€‚")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœæœåŠ¡å™¨åŒæ„åˆ‡æ¢ä¸º WebSocket åè®®ï¼ŒæœåŠ¡å™¨åº”è¯¥è¿”å›å“åº”ç  `101`")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("101")]),t._v(" Switching Protocols\nUpgrade"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" websocket\nConnection"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Upgrade\nSec"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("WebSocket"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Accept"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" hsBlbuDTkk24srzEOTBUlZAlC2g"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n")])])]),e("p",[t._v("ğŸ’¡ "),e("code",[t._v("Sec-WebSocket-Accept: Sec-WebSocket-Key")]),t._v(" è¡¨ç¤ºä½¿ç”¨ç‰¹æ®Šçš„ç®—æ³•é‡æ–°ç¼–ç ï¼Œæµè§ˆå™¨ä½¿ç”¨å®ƒæ¥ç¡®ä¿å“åº”ä¸è¯·æ±‚ç›¸å¯¹åº”ã€‚")]),t._v(" "),e("p",[t._v("ğŸ’¡ æ„é€ å‡½æ•° "),e("code",[t._v("WebSocket")]),t._v(" ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå¯é€‰ï¼‰å¯ç”¨äºè®¾ç½®å…¶ä»– header ä»¥ä½¿ç”¨æ‰©å±•å’Œå­åè®®ï¼Œå¦‚ "),e("code",[t._v("Sec-WebSocket-Extensions")]),t._v(" å’Œ "),e("code",[t._v("Sec-WebSocket-Protocol")]),t._v("ã€‚å¦‚æœæœåŠ¡å™¨æ”¯æŒè¿™äº›æ‰©å±•/å­åè®®ï¼Œåº”è¯¥ä½¿ç”¨åŒæ„ä½¿ç”¨çš„åè®®å’Œæ‰©å±•çš„åˆ—è¡¨è¿›è¡Œå“åº”ã€‚")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" socket "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocket")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wss://javascript.info/chat"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"soap"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wamp"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("h3",{attrs:{id:"è¿æ¥çŠ¶æ€"}},[t._v("è¿æ¥çŠ¶æ€")]),t._v(" "),e("p",[t._v("é€šè¿‡å±æ€§ "),e("code",[t._v("socket.readyState")]),t._v(" è·å–è¿æ¥çŠ¶æ€ï¼Œè¿”å›ä¸€ä¸ªæ•°å€¼è¡¨ç¤ºç›¸å¯¹åº”çš„çŠ¶æ€")]),t._v(" "),e("ul",[e("li",[e("strong",[e("code",[t._v("0")])]),t._v(" CONNECTING è¿æ¥è¿˜æœªå»ºç«‹ï¼Œ")]),t._v(" "),e("li",[e("strong",[e("code",[t._v("1")])]),t._v(" OPEN é€šä¿¡ä¸­ï¼Œ")]),t._v(" "),e("li",[e("strong",[e("code",[t._v("2")])]),t._v(" CLOSING è¿æ¥å…³é—­ä¸­ï¼Œ")]),t._v(" "),e("li",[e("strong",[e("code",[t._v("3")])]),t._v("  CLOSED è¿æ¥å·²å…³é—­")])]),t._v(" "),e("h2",{attrs:{id:"äº‹ä»¶ç›‘å¬"}},[t._v("äº‹ä»¶ç›‘å¬")]),t._v(" "),e("p",[t._v("ä¸€æ—¦ socket è¢«å»ºç«‹ï¼Œæˆ‘ä»¬å°±åº”è¯¥ç›‘å¬ socket ä¸Šçš„ 4 ä¸ªäº‹ä»¶")]),t._v(" "),e("ul",[e("li",[t._v("äº‹ä»¶ "),e("strong",[e("code",[t._v("open")])]),t._v(" è¡¨ç¤ºè¿æ¥å·²å»ºç«‹")]),t._v(" "),e("li",[t._v("äº‹ä»¶ "),e("strong",[e("code",[t._v("message")])]),t._v(" è¡¨ç¤ºæ¥æ”¶åˆ°æ•°æ®")]),t._v(" "),e("li",[t._v("äº‹ä»¶ "),e("strong",[e("code",[t._v("error")])]),t._v(" è¡¨ç¤º WebSocket é”™è¯¯")]),t._v(" "),e("li",[t._v("äº‹ä»¶ "),e("strong",[e("code",[t._v("close")])]),t._v(" è¡¨ç¤ºè¿æ¥å·²å…³é—­")])]),t._v(" "),e("p",[t._v("å¦‚æœéœ€è¦å‘é€æ•°æ®å°±ä½¿ç”¨æ–¹æ³• "),e("code",[t._v("socket.send(data)")])]),t._v(" "),e("h2",{attrs:{id:"æ•°æ®ä¼ è¾“"}},[t._v("æ•°æ®ä¼ è¾“")]),t._v(" "),e("p",[t._v("åˆ›å»ºè¿æ¥æˆåŠŸåå°±å¯ä»¥ä½¿ç”¨ WebSocket åè®®ä¼ è¾“æ•°æ®ï¼Œä½¿ç”¨æ–¹æ³• "),e("code",[t._v(".send()")]),t._v(" å‘é€æ–‡æœ¬æˆ–äºŒè¿›åˆ¶æ•°æ®ã€‚")]),t._v(" "),e("p",[t._v('WebSocket é€šä¿¡ç”±æ•°æ®ç‰‡æ®µ "frames" ç»„æˆï¼Œæœ‰ä»¥ä¸‹å‡ ç§ç±»å‹ï¼Œåœ¨æµè§ˆå™¨é‡Œä»…ç›´æ¥ä½¿ç”¨æ–‡æœ¬æˆ–äºŒè¿›åˆ¶ framesï¼š')]),t._v(" "),e("ul",[e("li",[t._v("text frames åŒ…å«å„æ–¹å‘é€ç»™å½¼æ­¤çš„æ–‡æœ¬æ•°æ®ã€‚")]),t._v(" "),e("li",[t._v("binary data frames åŒ…å«å„æ–¹å‘é€ç»™å½¼æ­¤çš„äºŒè¿›åˆ¶æ•°æ®ã€‚")]),t._v(" "),e("li",[t._v("ping/pong frames è¢«ç”¨äºæ£€æŸ¥ä»æœåŠ¡å™¨å‘é€çš„è¿æ¥ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å“åº”å®ƒä»¬ã€‚")]),t._v(" "),e("li",[t._v("connection close frame ä»¥åŠå…¶ä»–æœåŠ¡ framesã€‚")])]),t._v(" "),e("p",[t._v("ğŸ’¡ å½“æˆ‘ä»¬æ”¶åˆ°æ•°æ®æ—¶ï¼Œæ–‡æœ¬æ€»æ˜¯ä»¥å­—ç¬¦ä¸²å½¢å¼å‘ˆç°ï¼Œè€Œå¯¹äºäºŒè¿›åˆ¶æ•°æ®ï¼Œå®ƒæ˜¯ç”± "),e("code",[t._v("socket.bufferType")]),t._v(" å±æ€§è®¾ç½®çš„ï¼Œé»˜è®¤ä¸º "),e("code",[t._v('"blob"')]),t._v("ï¼Œå› æ­¤äºŒè¿›åˆ¶æ•°æ®é€šå¸¸ä»¥ "),e("code",[t._v("Blob")]),t._v(" å¯¹è±¡å‘ˆç°ã€‚"),e("a",{attrs:{href:"https://zh.javascript.info/blob",target:"_blank",rel:"noopener noreferrer"}},[t._v("Blob"),e("OutboundLink")],1),t._v(" æ˜¯é«˜çº§çš„äºŒè¿›åˆ¶å¯¹è±¡ï¼Œå®ƒç›´æ¥ä¸ "),e("code",[t._v("<a>")]),t._v("ï¼Œ"),e("code",[t._v("<img>")]),t._v(" åŠå…¶ä»–æ ‡ç­¾é›†æˆåœ¨ä¸€èµ·ï¼›ä½†æ˜¯å¯¹äºäºŒè¿›åˆ¶å¤„ç†ï¼Œè¦è®¿é—®å•ä¸ªæ•°æ®å­—èŠ‚ï¼Œå¯ä»¥å°†å…¶æ”¹ä¸º "),e("code",[t._v('"arraybuffer"')])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("socket"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bufferType "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"arraybuffer"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsocket"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// event.data å¯ä»¥æ˜¯æ–‡æœ¬ï¼ˆå¦‚æœæ˜¯æ–‡æœ¬ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ arraybufferï¼ˆå¦‚æœæ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼‰")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("h3",{attrs:{id:"é™é€Ÿ"}},[t._v("é™é€Ÿ")]),t._v(" "),e("p",[t._v("å½“ç”¨æˆ·çš„ç½‘é€Ÿå¾ˆæ…¢æ—¶æ•°æ®å°†ä¼šç¼“å†²ï¼ˆå‚¨å­˜ï¼‰åœ¨å†…å­˜ä¸­ï¼Œå¹¶ä¸”åªèƒ½åœ¨ç½‘é€Ÿå…è®¸çš„æƒ…å†µä¸‹å°½å¿«å°†æ•°æ®å‘é€å‡ºå»ã€‚")]),t._v(" "),e("p",[t._v("å±æ€§ "),e("code",[t._v("socket.bufferedAmount")]),t._v(" å‚¨å­˜ç›®å‰å·²ç¼“å†²çš„å­—èŠ‚æ•°ï¼Œç­‰å¾…é€šè¿‡ç½‘ç»œå‘é€ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥å®ƒæ§åˆ¶æ˜¯å¦ç»§ç»­è°ƒç”¨ "),e("code",[t._v("socket.send(newData)")]),t._v(" å‘é€æ–°æ•°æ®ã€‚")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ¯ 100ms æ£€æŸ¥ä¸€æ¬¡ socket")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä»…å½“æ‰€æœ‰ç°æœ‰çš„æ•°æ®éƒ½å·²è¢«å‘é€å‡ºå»æ—¶ï¼Œå†å‘é€æ›´å¤šæ•°æ®")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setInterval")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("socket"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bufferedAmount "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    socket"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("moreData")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("h2",{attrs:{id:"è¿æ¥å…³é—­"}},[t._v("è¿æ¥å…³é—­")]),t._v(" "),e("p",[t._v("å½“ä¸€æ–¹æƒ³è¦å…³é—­è¿æ¥æ—¶ï¼ˆæµè§ˆå™¨å’ŒæœåŠ¡å™¨éƒ½å…·æœ‰ç›¸åŒçš„æƒé™ï¼‰ï¼Œå®ƒä»¬ä½¿ç”¨æ–¹æ³• "),e("code",[t._v("close()")]),t._v(' ä¼šå‘é€ä¸€ä¸ªå¸¦æœ‰æ•°å­—ç  numeric code å’Œæ–‡æœ¬å½¢å¼çš„åŸå› çš„ "connection close frame"')]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("socket"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("code"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("reason"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("å‚æ•°è¯´æ˜ï¼š")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("code")]),t._v(" æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ WebSocket å…³é—­ç ï¼ˆå¯é€‰ï¼‰ï¼ŒWebSocket ç æœ‰ç‚¹åƒ HTTP ç ï¼Œä½†å®ƒä»¬æ˜¯ä¸åŒçš„ï¼Œç‰¹åˆ«æ˜¯å°äº "),e("code",[t._v("1000")]),t._v(" çš„ç éƒ½æ˜¯è¢«ä¿ç•™çš„ï¼Œå¦‚æœæˆ‘ä»¬å°è¯•è®¾ç½®è¿™æ ·çš„ç ï¼Œå°†ä¼šå‡ºç°é”™è¯¯ã€‚å¸¸è§çš„"),e("a",{attrs:{href:"https://tools.ietf.org/html/rfc6455#section-7.4.1",target:"_blank",rel:"noopener noreferrer"}},[t._v("æ•°å­—ç "),e("OutboundLink")],1),t._v("æœ‰\n"),e("ul",[e("li",[e("code",[t._v("1000")]),t._v(" é»˜è®¤ï¼Œæ­£å¸¸å…³é—­")]),t._v(" "),e("li",[e("code",[t._v("1006")]),t._v(" æ²¡æœ‰åŠæ³•æ‰‹åŠ¨è®¾å®šè¿™ä¸ªæ•°å­—ç ï¼Œè¡¨ç¤ºè¿æ¥ä¸¢å¤±ï¼ˆæ²¡æœ‰ close frameï¼‰")]),t._v(" "),e("li",[e("code",[t._v("1001")]),t._v(" ä¸€æ–¹æ­£åœ¨ç¦»å¼€ï¼Œå¦‚æœåŠ¡å™¨æ­£åœ¨å…³é—­æˆ–æµè§ˆå™¨ç¦»å¼€äº†è¯¥é¡µé¢")]),t._v(" "),e("li",[e("code",[t._v("1009")]),t._v(" æ¶ˆæ¯å¤ªå¤§ï¼Œæ— æ³•å¤„ç†")]),t._v(" "),e("li",[e("code",[t._v("1011")]),t._v(" æœåŠ¡å™¨ä¸Šå‘ç”Ÿæ„å¤–é”™è¯¯")])])]),t._v(" "),e("li",[e("code",[t._v("reason")]),t._v(" æ˜¯ä¸€ä¸ªæè¿°å…³é—­åŸå› çš„å­—ç¬¦ä¸²ï¼ˆå¯é€‰ï¼‰")])]),t._v(" "),e("p",[t._v("å¦ä¸€æ–¹é€šè¿‡ç›‘å¬äº‹ä»¶ "),e("code",[t._v("close")]),t._v("å¹¶è°ƒç”¨å¤„ç†å™¨è·å–å…³é—­ç å’Œå…³é—­åŸå› ")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å…³é—­æ–¹ï¼š")]),t._v("\nsocket"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Work complete"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦ä¸€æ–¹")]),t._v("\nsocket"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onclose")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// event.code === 1000")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// event.reason === "Work complete"')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// event.wasClean === true (clean close)")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("å…·ä½“å®ä¾‹æ¼”ç¤ºå¯æŸ¥çœ‹ï¼š"),e("a",{attrs:{href:"https://zh.javascript.info/websocket#liao-tian-shi-li",target:"_blank",rel:"noopener noreferrer"}},[t._v("èŠå¤©ç¤ºä¾‹"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("ğŸ’¡ å¦ä¸€ç§ä¸æœåŠ¡å™¨å»ºç«‹æŒä¹…è¿æ¥çš„æ–¹æ³•æ˜¯"),e("a",{attrs:{href:"https://zh.javascript.info/server-sent-events",target:"_blank",rel:"noopener noreferrer"}},[t._v("ä½¿ç”¨ "),e("code",[t._v("EventSource")]),t._v(" å¯¹è±¡åˆ›å»ºè¿æ¥"),e("OutboundLink")],1),t._v("ï¼Œå®ƒå…è®¸æœåŠ¡å™¨é€šè¿‡è¿™ä¸ªè¿æ¥å‘é€æ¶ˆæ¯ï¼ˆå•å‘ï¼‰ï¼Œè¿™ä½¿å¾— "),e("code",[t._v("EventSource")]),t._v(" æˆä¸º "),e("code",[t._v("WebSocket")]),t._v(" çš„ä¸€ä¸ªå¯è¡Œçš„æ›¿ä»£æ–¹æ¡ˆï¼ˆç®€å•ç‰ˆæœ¬ï¼‰ã€‚")])])}),[],!1,null,null,null);s.default=n.exports}}]);