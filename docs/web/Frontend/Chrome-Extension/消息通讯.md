---
type: series
series: chrome extension
tags:
  - chrome
---

# æ¶ˆæ¯é€šè®¯
å‚è€ƒï¼š
* [Message Passing](https://developer.chrome.com/extensions/messaging)
* [æ¶ˆæ¯é€šä¿¡](https://github.com/sxei/chrome-plugin-demo#%E6%B6%88%E6%81%AF%E9%80%9A%E4%BF%A1)

ä¸åŒçš„ JavaScript æ–‡æ¡£ï¼ˆä¸€èˆ¬æŒ‡ content scriptsã€background è¿è¡Œçš„ scriptsã€popup é¡µé¢æ‰€å¼•ç”¨çš„ scriptsï¼‰æ˜¯åœ¨ä¸åŒçš„ä½œç”¨åŸŸä¸­ï¼Œå®ƒä»¬ä¹‹é—´é€šè¿‡ Chrome æä¾›çš„ [API](https://developer.chrome.com/extensions/api_index) è¿›è¡Œäº‹ä»¶è§¦å‘å’Œç›‘å¬ä»¥å®ç°æ•°æ®ä¼ é€’å’Œ[æ¶ˆæ¯é€šä¿¡](https://developer.chrome.com/extensions/messaging)ã€‚

## background ä¸ content script
```js
// ğŸ“ background.js
// è®¾ç½®ä¸€ä¸ª browser action çš„ç›‘å¬å™¨ï¼Œç›‘å¬ onClicked äº‹ä»¶
chrome.browserAction.onClicked.addListener(buttonClicked);

function buttonClicked(tab) {
  // å½“ç”¨æˆ·ç‚¹å‡»æµè§ˆå™¨å³ä¸Šè§’çš„æ’ä»¶å›¾æ ‡æ—¶ä¼šæ‰§è¡Œè¯¥å‡½æ•°
  // å‚æ•° tab æ˜¯ä¸€ä¸ªå…³äºå½“å‰ç½‘é¡µæ ‡ç­¾çš„ä¿¡æ¯çš„å¯¹è±¡
  var msg = {
    message: "user clicked!"
  }
  // ä¼ é€’æ¶ˆæ¯
  chrome.tabs.sendMessage(tab.id, msg);
}
```

```js
// ğŸ“ content.js
// åœ¨ content script ç›‘å¬æ¶ˆæ¯
chrome.runtime.onMessage.addListener(receiver);

function receiver(request, sender, sendResponse) {
  // å½“æ¥å—åˆ°æ¶ˆæ¯åæ‰§è¡Œè¯¥å›è°ƒå‡½æ•°
  // ç¬¬ä¸€ä¸ªå‚æ•° request æ˜¯æ‰€æ¥æ”¶åˆ°çš„æ¶ˆæ¯
  if (request.message === "user clicked!") {
    // Do something!
  }
}
```

## popup è¯»å– background æ•°æ®
popup script å¯ä»¥ç›´æ¥è°ƒç”¨ background script ä¸­çš„æ–¹æ³•å’Œå˜é‡ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è®¿é—® background page çš„ DOM

```js
// ğŸ“ background.js
function test() {
	alert('æˆ‘æ˜¯ background');
}
```

```js
// ğŸ“ popup.js
var bg = chrome.extension.getBackgroundPage();
bg.test(); // è®¿é—®bgçš„å‡½æ•°
alert(bg.document.body.innerHTML); // è®¿é—® bg çš„DOM
```