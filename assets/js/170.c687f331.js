(window.webpackJsonp=window.webpackJsonp||[]).push([[170],{1115:function(t,s,n){t.exports=n.p+"assets/img/20200513190013590_15364.b206b1a2.png"},1448:function(t,s,n){"use strict";n.r(s);var a=n(18),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"é•¿è½®è¯¢"}},[t._v("é•¿è½®è¯¢")]),t._v(" "),a("p",[t._v("ä»æœåŠ¡å™¨è·å–æ–°ä¿¡æ¯çš„æœ€ç®€å•çš„æ–¹å¼æ˜¯å®šæœŸè½®è¯¢ï¼Œæ¯éš”å›ºå®šäº‹ä»¶å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚è·å–æ¶ˆæ¯ï¼ˆå³ä½¿æ•°æ®å¹¶æ— æ›´æ–°ï¼‰ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥åŠæ—¶æ›´æ–°æ•°æ®ä½†æ˜¯é¢‘ç¹å›ºå®šçš„è¯·æ±‚å¯èƒ½ä¼šé€ æˆæœåŠ¡å™¨å¾ˆå¤§è´Ÿæ‹…ï¼›é•¿è½®è¯¢åˆ™æ˜¯å¦ä¸€ç§æ˜¯ä¸æœåŠ¡å™¨ä¿æŒæŒä¹…è¿æ¥çš„æ›´å¥½æ–¹å¼ï¼Œå®ƒååˆ†ç®€å•ä¸ä½¿ç”¨ä»»ä½•ç‰¹å®šçš„åè®®ï¼Œä¹Ÿå¯ä»¥å®ç°ã€Œæ— å»¶è¿Ÿã€åœ°ä¼ é€’æ¶ˆæ¯ä»¥ä¿æŒæ•°æ®æ˜¯æœ€æ–°çš„ã€‚")]),t._v(" "),a("p",[t._v("é•¿è½®è¯¢ Long polling åŸºæœ¬æµç¨‹ï¼š")]),t._v(" "),a("ol",[a("li",[t._v("è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ï¼Œä¸æœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ª"),a("strong",[t._v("æŒ‚èµ· pending è¿æ¥")])]),t._v(" "),a("li",[t._v("æœåŠ¡å™¨ä¸ä¼šå…³é—­è¯¥è¿æ¥")]),t._v(" "),a("li",[t._v("ç›´åˆ°æœ‰æ•°æ®æ›´æ–°æ—¶ï¼ŒæœåŠ¡å™¨å°†å…¶ä½œä¸ºå“åº”å‘é€å›ç»™å®¢æˆ·ç«¯ï¼Œç„¶åè¿æ¥å°±ä¼šä¸­æ–­")]),t._v(" "),a("li",[t._v("æµè§ˆå™¨è¯»å–å“åº”åç«‹å³åˆå‘å‡ºä¸€ä¸ªæ–°çš„è¯·æ±‚ï¼Œä¸æœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªæŒ‚èµ·çš„è¿æ¥â€¦â€¦å¦‚æ­¤å¾ªç¯")])]),t._v(" "),a("p",[a("img",{attrs:{src:n(1115),alt:"long polling"}})]),t._v(" "),a("p",[t._v("ğŸ’¡ å¦‚æœè¿æ¥ä¸¢å¤±ï¼Œå¯èƒ½æ˜¯å› ä¸ºç½‘ç»œé”™è¯¯ï¼Œæµè§ˆå™¨ä¼šç«‹å³å‘é€ä¸€ä¸ªæ–°è¯·æ±‚ã€‚")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å®ç°é•¿è½®è¯¢çš„å®¢æˆ·ç«¯ subscribe å‡½æ•°")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("subscribe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" response "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/subscribe"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// çŠ¶æ€ 502 æ˜¯è¿æ¥è¶…æ—¶é”™è¯¯ï¼Œ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¿æ¥æŒ‚èµ·æ—¶é—´è¿‡é•¿æ—¶å¯èƒ½ä¼šå‘ç”Ÿï¼Œ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¿œç¨‹æœåŠ¡å™¨æˆ–ä»£ç†ä¼šå…³é—­å®ƒ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è®©æˆ‘ä»¬é‡æ–°è¿æ¥")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("subscribe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä¸€ä¸ª error â€”â€” è®©æˆ‘ä»¬æ˜¾ç¤ºå®ƒ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("showMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statusText"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä¸€ç§’åé‡æ–°è¿æ¥")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resolve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("subscribe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è·å–å¹¶æ˜¾ç¤ºæ¶ˆæ¯")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" message "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("text")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("showMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å½“ fetch è¯·æ±‚è¢«å¤„ç†å®Œæˆåï¼Œä¼šå†æ¬¡è°ƒç”¨ subscribe() å†æ¬¡å»ºç«‹ä¸€ä¸ªæŒ‚èµ·çš„è¿æ¥")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("subscribe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("subscribe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("å…·ä½“å®ä¾‹æ¼”ç¤ºå¯æŸ¥çœ‹ï¼š"),a("a",{attrs:{href:"https://zh.javascript.info/long-polling#shi-li-liao-tian",target:"_blank",rel:"noopener noreferrer"}},[t._v("èŠå¤©"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("âš ï¸ åœ¨æ¶ˆæ¯å¾ˆå°‘çš„æƒ…å†µä¸‹ï¼Œé•¿è½®è¯¢å¾ˆæœ‰æ•ˆã€‚å¦‚æœæ¶ˆæ¯æ¯”è¾ƒé¢‘ç¹ï¼Œé‚£ä¹ˆè¯·æ±‚ - æ¥æ”¶ requesting-receiving æ¶ˆæ¯çš„å›¾è¡¨å°±ä¼šå˜æˆé”¯çŠ¶çŠ¶ saw-likeï¼Œç”±äºæ¯ä¸ªæ¶ˆæ¯éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„è¯·æ±‚ï¼Œå¹¶å¸¦æœ‰ headerï¼Œèº«ä»½éªŒè¯å¼€é”€ï¼ˆauthentication overheadï¼‰ç­‰ï¼Œæ•ˆç‡è¾ƒä½ã€‚æ­¤æ—¶åº”è¯¥é€‰æ‹©å…¶ä»–æ–¹æ³•ï¼Œå¦‚ "),a("a",{attrs:{href:"https://zh.javascript.info/websocket",target:"_blank",rel:"noopener noreferrer"}},[t._v("Websocket"),a("OutboundLink")],1),t._v(" æˆ– "),a("a",{attrs:{href:"https://zh.javascript.info/server-sent-events",target:"_blank",rel:"noopener noreferrer"}},[t._v("Server Sent Events"),a("OutboundLink")],1),t._v("ã€‚")])])}),[],!1,null,null,null);s.default=e.exports}}]);